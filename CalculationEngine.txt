
/**
 * ======================================================
 * CALCULATION ENGINE
 * ------------------------------------------------------
 * SORUMLULUK:
 * - TÃœM finansal hesaplamalar
 * - FIFO
 * - Ortalama alÄ±ÅŸ / satÄ±ÅŸ
 * - Hisse bazlÄ± Ã¶zetler
 * - Para birimi bazÄ±nda toplam yatÄ±rÄ±mlar
 *
 * KESÄ°NLÄ°KLE:
 * âŒ Sheet okuma yok
 * âŒ UI yok
 * ======================================================
 */
const CalculationEngine = {

  /**
   * FIFO kar / zarar hesaplar
   * @param {Array<Object>} portfolio
   * @returns {Object} { id: karZarar }
   */
  calculateFIFOProfitLoss(portfolio) {
    console.log('ğŸ§® FIFO kar/zarar hesaplanÄ±yor...');

    const profitMap = {};
    const queues = {};

    // FIFO iÃ§in TARÄ°H SIRASI ÅART
    const sorted = [...portfolio].sort(
      (a, b) => (a.tarih?.getTime() || 0) - (b.tarih?.getTime() || 0)
    );

    sorted.forEach(item => {
      const key = `${item.baslik}__${item.birimi}`;
      queues[key] = queues[key] || [];

      const type = (item.islemTuru || '').toLowerCase();

      if (type.includes('al')) {
        queues[key].push({
          adet: item.adet,
          fiyat: item.birimFiyat
        });
        return;
      }

      if (type.includes('sat')) {
        let kalan = item.adet;
        let kar = 0;

        while (kalan > 0 && queues[key].length) {
          const alim = queues[key][0];
          const satilan = Math.min(alim.adet, kalan);

          kar += (item.birimFiyat - alim.fiyat) * satilan;

          alim.adet -= satilan;
          kalan -= satilan;

          if (alim.adet === 0) {
            queues[key].shift();
          }
        }

        if (kalan > 0) {
          console.warn(`âš ï¸ ${key}: ${kalan} adet satÄ±lamadÄ±`);
        }

        profitMap[item.id] = Number(kar.toFixed(2));
      }
    });

    return profitMap;
  },

  /**
   * Ortalama alÄ±ÅŸ fiyatlarÄ±nÄ± hesaplar
   */
  calculateAveragePurchasePrice(portfolio) {
    console.log('ğŸ“Š Ortalama alÄ±ÅŸ fiyatlarÄ± hesaplanÄ±yor...');

    const map = {};

    portfolio.forEach(i => {
      if (!i.islemTuru?.toLowerCase().includes('al')) return;

      const key = `${i.baslik}__${i.birimi}`;
      map[key] = map[key] || { adet: 0, tutar: 0 };

      map[key].adet += i.adet;
      map[key].tutar += i.toplamTutar;
    });

    Object.keys(map).forEach(k => {
      map[k] = Number((map[k].tutar / map[k].adet).toFixed(2));
    });

    return map;
  },

  /**
   * Ortalama satÄ±ÅŸ fiyatlarÄ±nÄ± hesaplar
   */
  calculateAverageSalePrice(portfolio) {
    console.log('ğŸ“Š Ortalama satÄ±ÅŸ fiyatlarÄ± hesaplanÄ±yor...');

    const map = {};

    portfolio.forEach(i => {
      if (!i.islemTuru?.toLowerCase().includes('sat')) return;

      const key = `${i.baslik}__${i.birimi}`;
      map[key] = map[key] || { adet: 0, tutar: 0 };

      map[key].adet += i.adet;
      map[key].tutar += i.toplamTutar;
    });

    Object.keys(map).forEach(k => {
      map[k] = Number((map[k].tutar / map[k].adet).toFixed(2));
    });

    return map;
  },

  /**
   * Hisse bazlÄ± Ã¶zet oluÅŸturur
   */
  calculateStockSummaries(portfolio) {
    console.log('ğŸ“ˆ Hisse bazlÄ± Ã¶zetler oluÅŸturuluyor...');

    const summary = {};

    portfolio.forEach(i => {
      const key = `${i.baslik}__${i.birimi}`;
      summary[key] = summary[key] || {
        toplamAlim: 0,
        toplamSatis: 0,
        toplamKar: 0
      };

      if (i.islemTuru.toLowerCase().includes('al')) {
        summary[key].toplamAlim += i.adet;
      }

      if (i.islemTuru.toLowerCase().includes('sat')) {
        summary[key].toplamSatis += i.adet;
        summary[key].toplamKar += i.karZarar || 0;
      }
    });

    Object.keys(summary).forEach(k => {
      summary[k].kalanAdet =
        summary[k].toplamAlim - summary[k].toplamSatis;
    });

    return summary;
  },

  /**
   * Para birimi bazÄ±nda toplam yatÄ±rÄ±m hesaplar
   * @param {Array<Object>} portfolio
   * @returns {Object} { paraBirimi: toplamYatirim }
   */
  calculateTotalInvestmentByCurrency(portfolio) {
    console.log('ğŸ’° Para birimi bazÄ±nda toplam yatÄ±rÄ±m hesaplanÄ±yor...');

    const currencyMap = {};

    portfolio.forEach(item => {
      // Sadece alÄ±m iÅŸlemlerini dikkate al
      if (!item.islemTuru?.toLowerCase().includes('al')) return;

      const currency = item.birimi || 'BELÄ°RSÄ°Z';
      const amount = item.toplamTutar || 0;

      currencyMap[currency] = (currencyMap[currency] || 0) + amount;
    });

    // SonuÃ§larÄ± yuvarla
    Object.keys(currencyMap).forEach(currency => {
      currencyMap[currency] = Number(currencyMap[currency].toFixed(2));
    });

    return currencyMap;
  },

  /**
   * VarlÄ±k bazÄ±nda toplam yatÄ±rÄ±m hesaplar
   * @param {Array<Object>} portfolio
   * @returns {Object} { varlikAdi: toplamYatirim }
   */
  calculateTotalInvestmentByAsset(portfolio) {
    console.log('ğŸ“¦ VarlÄ±k bazÄ±nda toplam yatÄ±rÄ±m hesaplanÄ±yor...');

    const assetMap = {};

    portfolio.forEach(item => {
      // Sadece alÄ±m iÅŸlemlerini dikkate al
      if (!item.islemTuru?.toLowerCase().includes('al')) return;

      const asset = item.baslik || 'BELÄ°RSÄ°Z';
      const amount = item.toplamTutar || 0;

      assetMap[asset] = (assetMap[asset] || 0) + amount;
    });

    // SonuÃ§larÄ± yuvarla
    Object.keys(assetMap).forEach(asset => {
      assetMap[asset] = Number(assetMap[asset].toFixed(2));
    });

    return assetMap;
  }
};
/**
 * ğŸ§ª CALCULATION ENGINE TESTÄ° - GERÃ‡EK VERÄ°LER ÃœZERÄ°NDE
 * 
 * AMAÃ‡:
 * - CalculationEngine'Ä±n tÃ¼m fonksiyonlarÄ±nÄ± gerÃ§ek portfÃ¶y verisiyle test et
 * - FIFO hesaplamalarÄ±nÄ± detaylÄ± kontrol et
 * - Matematiksel doÄŸruluÄŸu doÄŸrula
 * - Hata durumlarÄ±nÄ± yÃ¶net
 */
function test_CalculationEngine_RealData() {
  console.log('='.repeat(70));
  console.log('ğŸ§ª CALCULATION ENGINE TESTÄ° - GERÃ‡EK VERÄ°LER');
  console.log('='.repeat(70));
  
  const startTime = new Date();
  const testResults = {
    totalTests: 0,
    passed: 0,
    failed: 0,
    errors: []
  };
  
  try {
    // 1. Ã–N HAZIRLIK: GerÃ§ek veriyi oku
    console.log('\n1ï¸âƒ£ GERÃ‡EK VERÄ° OKUNUYOR...');
    const portfolio = DataReader.readPortfolio();
    
    if (!portfolio || portfolio.length === 0) {
      console.log('âŒ Test edilecek portfÃ¶y verisi yok!');
      return testResults;
    }
    
    console.log(`âœ… ${portfolio.length} gerÃ§ek kayÄ±t okundu`);
    
    // 2. CALCULATION ENGINE KONTROLÃœ
    console.log('\n2ï¸âƒ£ CALCULATION ENGINE KONTROLÃœ');
    testResults.totalTests++;
    
    if (typeof CalculationEngine === 'undefined') {
      console.log('âŒ CalculationEngine tanÄ±mlÄ± deÄŸil!');
      testResults.failed++;
      testResults.errors.push('CalculationEngine nesnesi bulunamadÄ±');
      return testResults;
    }
    
    console.log('âœ… CalculationEngine mevcut');
    testResults.passed++;
    
    // 3. FIFO KAR/ZARAR HESAPLAMA TESTÄ°
    console.log('\n3ï¸âƒ£ FIFO KAR/ZARAR HESAPLAMA TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('ğŸ§® FIFO hesaplanÄ±yor...');
      const fifoResults = CalculationEngine.calculateFIFOProfitLoss(portfolio);
      
      if (typeof fifoResults === 'object' && fifoResults !== null) {
        console.log(`âœ… FIFO hesaplamasÄ± tamamlandÄ±: ${Object.keys(fifoResults).length} kayÄ±t`);
        
        // FIFO sonuÃ§larÄ±nÄ± analiz et
        const positiveCount = Object.values(fifoResults).filter(v => v > 0).length;
        const negativeCount = Object.values(fifoResults).filter(v => v < 0).length;
        const zeroCount = Object.values(fifoResults).filter(v => v === 0).length;
        const totalProfit = Object.values(fifoResults).reduce((sum, val) => sum + val, 0);
        
        console.log(`   ğŸ“Š Kar: ${positiveCount}, Zarar: ${negativeCount}, NÃ¶tr: ${zeroCount}`);
        console.log(`   ğŸ’° Toplam Kar/Zarar: ${totalProfit.toFixed(2)}`);
        
        // Ä°lk 5 FIFO sonucunu gÃ¶ster
        console.log('\n   ğŸ” Ä°LK 5 FIFO SONUCU:');
        Object.entries(fifoResults).slice(0, 5).forEach(([id, profit], index) => {
          console.log(`      ${index + 1}. ID ${id}: ${profit.toFixed(2)}`);
        });
        
        testResults.passed++;
      } else {
        console.log('âŒ FIFO sonucu beklenen formatta deÄŸil');
        testResults.failed++;
        testResults.errors.push('FIFO sonucu object deÄŸil');
      }
    } catch (error) {
      console.log(`âŒ FIFO hesaplama hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`FIFO hatasÄ±: ${error.message}`);
    }
    
    // 4. ORTALAMA ALIÅ FÄ°YATI TESTÄ°
    console.log('\n4ï¸âƒ£ ORTALAMA ALIÅ FÄ°YATI TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('ğŸ“Š Ortalama alÄ±ÅŸ fiyatlarÄ± hesaplanÄ±yor...');
      const avgPurchase = CalculationEngine.calculateAveragePurchasePrice(portfolio);
      
      if (typeof avgPurchase === 'object') {
        const assetCount = Object.keys(avgPurchase).length;
        console.log(`âœ… ${assetCount} varlÄ±k iÃ§in ortalama alÄ±ÅŸ fiyatÄ± hesaplandÄ±`);
        
        if (assetCount > 0) {
          console.log('\n   ğŸ” ORTALAMA ALIÅ FÄ°YATLARI:');
          Object.entries(avgPurchase).slice(0, 5).forEach(([asset, avgPrice], index) => {
            console.log(`      ${index + 1}. ${asset}: ${avgPrice.toFixed(2)}`);
          });
        }
        
        testResults.passed++;
      } else {
        console.log('âŒ Ortalama alÄ±ÅŸ fiyatÄ± sonucu beklenen formatta deÄŸil');
        testResults.failed++;
        testResults.errors.push('Ortalama alÄ±ÅŸ fiyatÄ± object deÄŸil');
      }
    } catch (error) {
      console.log(`âŒ Ortalama alÄ±ÅŸ fiyatÄ± hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`Ortalama alÄ±ÅŸ hatasÄ±: ${error.message}`);
    }
    
    // 5. ORTALAMA SATIÅ FÄ°YATI TESTÄ°
    console.log('\n5ï¸âƒ£ ORTALAMA SATIÅ FÄ°YATI TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('ğŸ“Š Ortalama satÄ±ÅŸ fiyatlarÄ± hesaplanÄ±yor...');
      const avgSale = CalculationEngine.calculateAverageSalePrice(portfolio);
      
      if (typeof avgSale === 'object') {
        const assetCount = Object.keys(avgSale).length;
        console.log(`âœ… ${assetCount} varlÄ±k iÃ§in ortalama satÄ±ÅŸ fiyatÄ± hesaplandÄ±`);
        
        if (assetCount > 0) {
          console.log('\n   ğŸ” ORTALAMA SATIÅ FÄ°YATLARI:');
          Object.entries(avgSale).slice(0, 5).forEach(([asset, avgPrice], index) => {
            console.log(`      ${index + 1}. ${asset}: ${avgPrice.toFixed(2)}`);
          });
        }
        
        testResults.passed++;
      } else {
        console.log('âŒ Ortalama satÄ±ÅŸ fiyatÄ± sonucu beklenen formatta deÄŸil');
        testResults.failed++;
        testResults.errors.push('Ortalama satÄ±ÅŸ fiyatÄ± object deÄŸil');
      }
    } catch (error) {
      console.log(`âŒ Ortalama satÄ±ÅŸ fiyatÄ± hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`Ortalama satÄ±ÅŸ hatasÄ±: ${error.message}`);
    }
    
    // 6. HÄ°SSE BAZLI Ã–ZET TESTÄ°
    console.log('\n6ï¸âƒ£ HÄ°SSE BAZLI Ã–ZET TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('ğŸ“ˆ Hisse bazlÄ± Ã¶zetler hesaplanÄ±yor...');
      const stockSummaries = CalculationEngine.calculateStockSummaries(portfolio);
      
      if (typeof stockSummaries === 'object') {
        const assetCount = Object.keys(stockSummaries).length;
        console.log(`âœ… ${assetCount} varlÄ±k iÃ§in hisse bazlÄ± Ã¶zet hesaplandÄ±`);
        
        if (assetCount > 0) {
          console.log('\n   ğŸ” HÄ°SSE BAZLI Ã–ZETLER (ilk 5):');
          Object.entries(stockSummaries).slice(0, 5).forEach(([asset, summary], index) => {
            console.log(`      ${index + 1}. ${asset}:`);
            console.log(`         AlÄ±m: ${summary.toplamAlim || 0} adet`);
            console.log(`         SatÄ±ÅŸ: ${summary.toplamSatis || 0} adet`);
            console.log(`         Kalan: ${summary.kalanAdet || 0} adet`);
            console.log(`         Kar: ${(summary.toplamKar || 0).toFixed(2)}`);
          });
        }
        
        testResults.passed++;
      } else {
        console.log('âŒ Hisse bazlÄ± Ã¶zet sonucu beklenen formatta deÄŸil');
        testResults.failed++;
        testResults.errors.push('Hisse bazlÄ± Ã¶zet object deÄŸil');
      }
    } catch (error) {
      console.log(`âŒ Hisse bazlÄ± Ã¶zet hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`Hisse bazlÄ± Ã¶zet hatasÄ±: ${error.message}`);
    }
    
    // 7. VERÄ° BÃœTÃœNLÃœK TESTÄ°
    console.log('\n7ï¸âƒ£ VERÄ° BÃœTÃœNLÃœK TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('ğŸ” FIFO sonuÃ§larÄ±nÄ±n portfÃ¶ye eklenmesi kontrol ediliyor...');
      
      // FIFO sonuÃ§larÄ±nÄ± al
      const fifoResults = CalculationEngine.calculateFIFOProfitLoss(portfolio);
      
      // PortfÃ¶yÃ¼ FIFO sonuÃ§larÄ±yla zenginleÅŸtir
      const enrichedPortfolio = portfolio.map(item => ({
        ...item,
        karZarar: fifoResults[item.id] || 0
      }));
      
      // Kar/zarar deÄŸerlerini kontrol et
      const hasKarZarar = enrichedPortfolio.every(item => 'karZarar' in item);
      const karZararValues = enrichedPortfolio.map(item => item.karZarar);
      const maxProfit = Math.max(...karZararValues);
      const minProfit = Math.min(...karZararValues);
      
      if (hasKarZarar) {
        console.log('âœ… TÃ¼m kayÄ±tlara kar/zarar deÄŸeri eklendi');
        console.log(`   ğŸ“Š En yÃ¼ksek kar: ${maxProfit.toFixed(2)}`);
        console.log(`   ğŸ“Š En yÃ¼ksek zarar: ${minProfit.toFixed(2)}`);
        console.log(`   ğŸ“Š Toplam: ${karZararValues.reduce((a, b) => a + b, 0).toFixed(2)}`);
        
        // Ã–rnek kayÄ±tlarÄ± gÃ¶ster
        console.log('\n   ğŸ” ZENGÄ°NLEÅTÄ°RÄ°LMÄ°Å Ã–RNEK KAYITLAR (ilk 3):');
        enrichedPortfolio.slice(0, 3).forEach((item, index) => {
          console.log(`      ${index + 1}. ${item.baslik || 'Belirsiz'}:`);
          console.log(`         Ä°ÅŸlem: ${item.islemTuru || 'Belirsiz'}`);
          console.log(`         Adet: ${item.adet || 0} Ã— ${item.birimFiyat || 0} = ${item.toplamTutar || 0}`);
          console.log(`         Kar/Zarar: ${item.karZarar || 0}`);
        });
        
        testResults.passed++;
      } else {
        console.log('âŒ BazÄ± kayÄ±tlarda kar/zarar deÄŸeri eksik');
        testResults.failed++;
        testResults.errors.push('Kar/zarar deÄŸerleri eksik');
      }
    } catch (error) {
      console.log(`âŒ Veri bÃ¼tÃ¼nlÃ¼k testi hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`Veri bÃ¼tÃ¼nlÃ¼k hatasÄ±: ${error.message}`);
    }
    
    // 8. PERFORMANS TESTÄ°
    console.log('\n8ï¸âƒ£ PERFORMANS TESTÄ°');
    testResults.totalTests++;
    
    try {
      console.log('â±ï¸  BÃ¼yÃ¼k portfÃ¶y iÃ§in performans testi...');
      
      // AynÄ± portfÃ¶yÃ¼ 10 kez iÅŸleyerek performans testi yap
      const testCycles = 10;
      const startPerf = new Date();
      
      for (let i = 0; i < testCycles; i++) {
        CalculationEngine.calculateFIFOProfitLoss(portfolio);
      }
      
      const endPerf = new Date();
      const totalTime = (endPerf - startPerf) / 1000;
      const avgTime = totalTime / testCycles;
      
      console.log(`âœ… ${testCycles} dÃ¶ngÃ¼ tamamlandÄ±`);
      console.log(`   â±ï¸  Toplam sÃ¼re: ${totalTime.toFixed(3)} saniye`);
      console.log(`   â±ï¸  Ortalama: ${avgTime.toFixed(3)} saniye/dÃ¶ngÃ¼`);
      console.log(`   ğŸ“ˆ KayÄ±t baÅŸÄ±na: ${(avgTime / portfolio.length * 1000).toFixed(3)} ms/kayÄ±t`);
      
      if (avgTime < 1) {
        console.log('   ğŸš€ Performans: MÃœKEMMEL');
      } else if (avgTime < 5) {
        console.log('   âœ… Performans: Ä°YÄ°');
      } else {
        console.log('   âš ï¸  Performans: YAVAÅ');
      }
      
      testResults.passed++;
    } catch (error) {
      console.log(`âŒ Performans testi hatasÄ±: ${error.message}`);
      testResults.failed++;
      testResults.errors.push(`Performans testi hatasÄ±: ${error.message}`);
    }
    
  } catch (error) {
    console.error(`ğŸ’¥ GENEL TEST HATASI: ${error.message}`);
    testResults.errors.push(`Genel hata: ${error.message}`);
  }
  
  // TEST SONUÃ‡LARI
  const duration = (new Date().getTime() - startTime.getTime()) / 1000;
  
  console.log('\n' + '='.repeat(70));
  console.log('ğŸ“Š CALCULATION ENGINE TEST SONUÃ‡LARI');
  console.log('='.repeat(70));
  
  console.log(`Toplam Test: ${testResults.totalTests}`);
  console.log(`BaÅŸarÄ±lÄ±: ${testResults.passed}`);
  console.log(`BaÅŸarÄ±sÄ±z: ${testResults.failed}`);
  console.log(`BaÅŸarÄ± OranÄ±: ${testResults.totalTests > 0 ? ((testResults.passed / testResults.totalTests) * 100).toFixed(1) : 0}%`);
  console.log(`Toplam SÃ¼re: ${duration.toFixed(2)} saniye`);
  
  if (testResults.failed === 0 && testResults.totalTests > 0) {
    console.log('\nğŸ‰ TÃœM TESTLER BAÅARILI! CalculationEngine mÃ¼kemmel Ã§alÄ±ÅŸÄ±yor.');
  } else if (testResults.passed > 0) {
    console.log(`\nâš ï¸ BAZI TESTLER BAÅARISIZ! ${testResults.failed} test baÅŸarÄ±sÄ±z oldu.`);
    
    if (testResults.errors.length > 0) {
      console.log('\nHatalar:');
      testResults.errors.forEach((error, index) => {
        console.log(`  ${index + 1}. ${error}`);
      });
    }
  } else {
    console.log('\nâŒ TESTLER TAMAMLANAMADI!');
  }
  
  console.log('\n' + '='.repeat(70));
  return testResults;
}

/**
 * âš¡ HIZLI CALCULATION ENGINE TESTÄ° (Temel Kontrol)
 * 
 * Sadece temel iÅŸlevleri hÄ±zlÄ±ca test eder
 */
function quick_CalculationEngine_Test() {
  console.log('âš¡ HIZLI CALCULATION ENGINE TESTÄ°');
  
  const startTime = new Date();
  let passed = 0;
  let total = 0;
  
  try {
    // 1. Veriyi oku
    const portfolio = DataReader.readPortfolio();
    if (!portfolio || portfolio.length === 0) {
      console.log('âŒ Test edilecek veri yok');
      return false;
    }
    
    console.log(`ğŸ“¦ ${portfolio.length} kayÄ±t okundu`);
    
    // 2. FIFO testi
    total++;
    console.log('\n1. FIFO Testi...');
    try {
      const fifo = CalculationEngine.calculateFIFOProfitLoss(portfolio);
      if (fifo && typeof fifo === 'object') {
        console.log(`âœ… BaÅŸarÄ±lÄ±: ${Object.keys(fifo).length} FIFO sonucu`);
        passed++;
      } else {
        console.log('âŒ FIFO sonucu beklenen formatta deÄŸil');
      }
    } catch (e) {
      console.log(`âŒ FIFO hatasÄ±: ${e.message}`);
    }
    
    // 3. Ortalama alÄ±ÅŸ testi
    total++;
    console.log('\n2. Ortalama AlÄ±ÅŸ Testi...');
    try {
      const avgBuy = CalculationEngine.calculateAveragePurchasePrice(portfolio);
      if (avgBuy && typeof avgBuy === 'object') {
        console.log(`âœ… BaÅŸarÄ±lÄ±: ${Object.keys(avgBuy).length} varlÄ±k`);
        passed++;
      } else {
        console.log('âŒ Ortalama alÄ±ÅŸ sonucu beklenen formatta deÄŸil');
      }
    } catch (e) {
      console.log(`âŒ Ortalama alÄ±ÅŸ hatasÄ±: ${e.message}`);
    }
    
    // 4. Hisse Ã¶zet testi
    total++;
    console.log('\n3. Hisse Ã–zet Testi...');
    try {
      const summaries = CalculationEngine.calculateStockSummaries(portfolio);
      if (summaries && typeof summaries === 'object') {
        console.log(`âœ… BaÅŸarÄ±lÄ±: ${Object.keys(summaries).length} hisse Ã¶zeti`);
        passed++;
        
        // Bir Ã¶rnek gÃ¶ster
        if (Object.keys(summaries).length > 0) {
          const firstKey = Object.keys(summaries)[0];
          console.log(`   Ã–rnek: ${firstKey}`);
          console.log(`     AlÄ±m: ${summaries[firstKey].toplamAlim}`);
          console.log(`     SatÄ±ÅŸ: ${summaries[firstKey].toplamSatis}`);
          console.log(`     Kalan: ${summaries[firstKey].kalanAdet}`);
        }
      } else {
        console.log('âŒ Hisse Ã¶zeti sonucu beklenen formatta deÄŸil');
      }
    } catch (e) {
      console.log(`âŒ Hisse Ã¶zeti hatasÄ±: ${e.message}`);
    }
    
    // SONUÃ‡
    const duration = (new Date().getTime() - startTime.getTime()) / 1000;
    
    console.log('\n' + '='.repeat(40));
    console.log('ğŸ“Š HIZLI TEST SONUCU');
    console.log(`BaÅŸarÄ±lÄ±: ${passed}/${total}`);
    console.log(`BaÅŸarÄ± OranÄ±: ${((passed / total) * 100).toFixed(1)}%`);
    console.log(`SÃ¼re: ${duration.toFixed(2)} saniye`);
    
    if (passed === total) {
      console.log('âœ… TÃœM TESTLER BAÅARILI!');
      return true;
    } else {
      console.log('âš ï¸ BAZI TESTLER BAÅARISIZ!');
      return false;
    }
    
  } catch (error) {
    console.error(`ğŸ’¥ Test hatasÄ±: ${error.message}`);
    return false;
  }
}